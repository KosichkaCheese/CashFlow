{% extends "base.html" %}
{% block content %}
  <h1 class="page-title">Удалить запись</h1>

  <div class="form-container">
    <p class="delete-text">
      Вы уверены, что хотите удалить запись:  
      <strong id="record-name">{{ object }}</strong>?
    </p>

    <form id="delete-form">
      {% csrf_token %}
      <div class="form-buttons">
        <button type="submit" class="btn btn-del">Да, удалить</button>
        <a href="{% url 'dds:record_list' %}" class="btn btn-cancel">Отмена</a>
      </div>
    </form>
  </div>

  <script>
    const recordId = "{{ object.pk }}";
    
    document.getElementById('delete-form').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      try {
        
        const response = await fetch(`/api/cashflows/${recordId}/`, {
          method: 'DELETE',
          headers: {
            'X-Requested-With': 'XMLHttpRequest'
          }
        });
        
        if (response.ok) {
          alert('Запись успешно удалена!');
          window.location.href = "{% url 'dds:record_list' %}";
        } else {
          const errorData = await response.json().catch(() => ({ detail: 'Ошибка удаления' }));
          alert('Ошибка при удалении: ' + JSON.stringify(errorData));
        }
      } catch (error) {
        console.error('Ошибка:', error);
        alert('Произошла ошибка при удалении записи');
      }
    });
  </script>
{% endblock %}